<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rounded IDEAL Chatbot</title>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Roboto, sans-serif;}
body {background:transparent; display:flex; justify-content:center; align-items:center; height:100vh;}
.chat-container {width:420px;height:600px;background:linear-gradient(135deg,#FFDAB9,#87CEFA);border-radius:50px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.2);position:relative;animation:fadeInContainer 0.5s ease-in-out;}
@keyframes fadeInContainer {0%{opacity:0;transform:scale(0.95);}100%{opacity:1;transform:scale(1);}}
.chat-header {background: rgba(255,255,255,0.3);color:black;padding:15px;display:flex;justify-content:space-between;align-items:center;border-top-left-radius:50px;border-top-right-radius:50px;}
.chat-header h3 {font-size:16px;font-weight:bold;}
.chat-header select {padding:5px 8px;border-radius:15px;border:none;font-weight:bold;cursor:pointer;background:white;color:black;}
.chat-header button {margin-left:5px;padding:5px 8px;border-radius:15px;border:none;cursor:pointer;font-weight:bold;}
.chat-messages {flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;background: rgba(255,255,255,0.2);scroll-behavior: smooth;border-radius: 50px;}
.message {display:flex;max-width:70%;padding:10px 15px;border-radius:20px;line-height:1.4;animation:fadeInBubble 0.3s;}
.message.bot {background:white;align-self:flex-start;animation:slideInLeft 0.3s;}
.message.user {background:#1e90ff;color:white;align-self:flex-end;animation:slideInRight 0.3s;}
@keyframes fadeInBubble {0%{opacity:0;}100%{opacity:1;}}
@keyframes slideInLeft {0%{opacity:0;transform:translateX(-50px);}100%{opacity:1;transform:translateX(0);}}
@keyframes slideInRight {0%{opacity:0;transform:translateX(50px);}100%{opacity:1;transform:translateX(0);}}
.chat-input-area {padding:10px;display:flex;gap:5px;align-items:center;border-top:1px solid #ccc;border-bottom-left-radius:50px;border-bottom-right-radius:50px;}
.chat-input {flex:1;padding:10px;border-radius:25px;border:1px solid #ccc;outline:none;}
.send-btn {background:#FFB347;color:white;border:none;padding:10px 15px;border-radius:50%;cursor:pointer;font-weight:bold;transition:transform 0.2s;}
.send-btn:hover {transform:scale(1.1);}
.control-btn {background:#87CEFA;color:white;border:none;padding:5px 8px;border-radius:15px;cursor:pointer;font-size:14px;}
.typing-indicator {display:flex;gap:3px;margin-left:5px;}
.typing-dots span {width:6px;height:6px;background:#999;border-radius:50%;animation:typing 1.2s infinite;}
.typing-dots span:nth-child(2){animation-delay:0.2s;}
.typing-dots span:nth-child(3){animation-delay:0.4s;}
@keyframes typing{0%,60%,100%{transform:translateY(0);}30%{transform:translateY(-8px);}}
</style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <h3>Ideal Institute Assistant</h3>
        <div>
            <select id="languageSelector">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
            </select>
            <button id="muteBtn" class="control-btn">üîä</button>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages">
        <div class="message bot" id="welcomeMsg">Hello! I am your AI assistant. How can I help you?</div>
    </div>

    <div class="chat-input-area">
        <input type="text" id="chatInput" class="chat-input" placeholder="Type your message...">
        <button id="voiceBtn" class="control-btn">üé§</button>
        <button id="sendBtn" class="send-btn">‚û§</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
let isMuted=false;
const chatMessages=document.getElementById('chatMessages');
const chatInput=document.getElementById('chatInput');
const sendBtn=document.getElementById('sendBtn');
const voiceBtn=document.getElementById('voiceBtn');
const muteBtn=document.getElementById('muteBtn');
const languageSelector=document.getElementById('languageSelector');
const synthesis=window.speechSynthesis;

// Working translation function (Google Translate)
async function translateText(text, targetLang){
    if(targetLang==='en') return text;
    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
    try{
        const res = await fetch(url);
        const data = await res.json();
        return data[0].map(item=>item[0]).join('');
    }catch(e){console.log('Translation error',e); return text;}
}

// Add message
function addMessage(text,sender='bot'){
    const msgDiv=document.createElement('div');
    msgDiv.className='message '+sender;
    msgDiv.textContent=text;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    if(sender==='bot' && !isMuted){
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang=languageSelector.value==='en'?'en-US':languageSelector.value==='hi'?'hi-IN':'te-IN';
        synthesis.speak(utter);
    }
}

// Typing indicator
function showTyping(){
    const typingDiv=document.createElement('div');
    typingDiv.className='message bot';
    typingDiv.id='typingIndicator';
    typingDiv.innerHTML='<div class="typing-indicator"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}
function hideTyping(){const t=document.getElementById('typingIndicator'); if(t) t.remove();}

// Send message
async function sendMessage(){
    const msg=chatInput.value.trim();
    if(!msg) return;
    addMessage(msg,'user');
    chatInput.value='';
    showTyping();
    try{
        const userLang = languageSelector.value;
        // Translate user input to English if not English
        let translatedInput = userLang==='en'? msg : await translateText(msg,'en');

        const res = await axios.post('http://127.0.0.1:8000/chat',{query:translatedInput});
        hideTyping();

        let botText = res.data.answer || "Sorry, I couldn't fetch response.";
        if(userLang!=='en') botText = await translateText(botText,userLang);
        addMessage(botText,'bot');

    }catch(err){
        hideTyping();
        addMessage("Error fetching response.","bot");
        console.error(err);
    }
}

// Event listeners
sendBtn.addEventListener('click',sendMessage);
chatInput.addEventListener('keypress',e=>{if(e.key==='Enter'){e.preventDefault();sendMessage();}});
muteBtn.addEventListener('click',()=>{isMuted=!isMuted; muteBtn.textContent=isMuted?'üîá':'üîä';});

// Voice input
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.continuous=false; recognition.interimResults=false;
    recognition.lang='en-US';
    voiceBtn.addEventListener('click',()=>{
        recognition.lang=languageSelector.value==='en'?'en-US':languageSelector.value==='hi'?'hi-IN':'te-IN';
        recognition.start();
    });
    recognition.onresult=e=>{chatInput.value=e.results[0][0].transcript; sendMessage();}
}
</script>
</body>
</html>  
